<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Professional vehicle insurance management system">
    <title>{% block title %}Vehicle Insurance{% endblock %}</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Modern CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/heroicons@2.0.18/24/outline/style.css">
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'sans': ['Inter', 'system-ui', 'sans-serif'],
            },
            colors: {
              brand: {
                50: '#eff6ff',
                100: '#dbeafe',
                200: '#bfdbfe',
                300: '#93c5fd',
                400: '#60a5fa',
                500: '#3b82f6',
                600: '#2563eb',
                700: '#1d4ed8',
                800: '#1e40af',
                900: '#1e3a8a',
              },
              success: {
                50: '#f0fdf4',
                500: '#22c55e',
                600: '#16a34a',
              },
              warning: {
                50: '#fffbeb',
                500: '#f59e0b',
                600: '#d97706',
              },
              error: {
                50: '#fef2f2',
                500: '#ef4444',
                600: '#dc2626',
              }
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-up': 'slideUp 0.3s ease-out',
              'pulse-soft': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              slideUp: {
                '0%': { transform: 'translateY(10px)', opacity: '0' },
                '100%': { transform: 'translateY(0)', opacity: '1' },
              }
            }
          }
        }
      }
    </script>
    
    <!-- Custom CSS -->
    <style>
      .glass-effect {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.1);
      }
      
      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      .card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      
      .focus-ring {
        @apply focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2;
      }
      
      .btn-primary {
        @apply bg-brand-600 hover:bg-brand-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus-ring;
      }
      
      .btn-secondary {
        @apply bg-gray-100 hover:bg-gray-200 text-gray-900 font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus-ring;
      }
      
      .input-field {
        @apply block w-full rounded-lg border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 sm:text-sm;
      }
      
      /* Navigation Styles */
      .nav-link {
        @apply flex items-center space-x-2 px-4 py-2.5 rounded-xl text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50/80 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 group;
      }

      .nav-link-active {
        @apply text-blue-600 bg-blue-50/80 hover:bg-blue-100/80 hover:text-blue-700 shadow-sm;
      }

      .nav-link svg {
        @apply transition-transform duration-200;
      }

      .nav-link:hover svg {
        @apply scale-110;
      }

      .dropdown-item {
        @apply flex items-center space-x-3 px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-gray-900 transition-all duration-150 focus:outline-none focus:bg-gray-50 rounded-lg mx-2;
      }

      .mobile-nav-link {
        @apply flex items-center px-4 py-3 rounded-xl text-base font-medium text-gray-600 hover:text-gray-900 hover:bg-white/80 transition-all duration-200 backdrop-blur-sm;
      }

      .mobile-nav-link-active {
        @apply text-blue-600 bg-white/90 shadow-sm;
      }
    </style>
    
    {% block extra_head %}{% endblock %}
  </head>
  
  <body class="h-full bg-gray-50 font-sans antialiased">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-brand-600 text-white px-4 py-2 rounded-lg z-50">
      Skip to main content
    </a>
    
    <!-- Header -->
    <header class="bg-white/95 backdrop-blur-sm shadow-lg border-b border-gray-200/50 sticky top-0 z-50" role="banner">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
          
          <!-- Logo and Brand -->
          <div class="flex items-center">
            <a href="{% if user.is_authenticated and not is_super_admin %}{% url 'dashboard:home' %}{% elif user.is_authenticated and is_super_admin %}{% url 'super_admin:home' %}{% else %}#{% endif %}" 
               class="group flex items-center space-x-3 text-xl font-semibold text-gray-900 hover:text-blue-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl px-3 py-2"
               aria-label="Vehicle Management System Dashboard">
              <div class="relative">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-200">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                  </svg>
                </div>
                <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-white animate-pulse"></div>
              </div>
              <div class="flex flex-col">
                <span class="text-gray-900 font-bold tracking-tight">VehicleHub</span>
                {% if current_tenant and not is_super_admin %}
                <span class="text-xs text-gray-500 font-medium bg-gray-100 px-2 py-0.5 rounded-full">{{ current_tenant.name }}</span>
                {% endif %}
              </div>
            </a>
          </div>

          <!-- Desktop Navigation -->
          <nav class="hidden lg:flex items-center" role="navigation" aria-label="Main navigation">
            {% if user.is_authenticated and not is_super_admin %}
              {% with current_url=request.resolver_match.url_name %}
              <ul class="flex items-center space-x-1">
                <!-- Core operations -->
                <li>
                  <a href="{% url 'dashboard:home' %}" 
                     class="nav-link {% if current_url == 'home' %}nav-link-active{% endif %}"
                     aria-current="{% if current_url == 'home' %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    <span class="truncate">Dashboard</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'dashboard:customers_list' %}" 
                     class="nav-link {% if 'customer' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'customer' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                    </svg>
                    <span class="truncate">Customers</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'dashboard:vehicles_list' %}" 
                     class="nav-link {% if 'vehicle' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'vehicle' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                    </svg>
                    <span class="truncate">Vehicles</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'dashboard:policies_list' %}" 
                     class="nav-link {% if 'polic' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'polic' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" clip-rule="evenodd"/>
                    </svg>
                    <span class="truncate">Policies</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'dashboard:policies_report' %}" 
                     class="nav-link {% if 'report' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'report' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                    </svg>
                    <span class="truncate">Reports</span>
                  </a>
                </li>

                {% if user.role == 'admin' or user.role == 'manager' %}
                <!-- Configuration & team -->
                <li class="ml-2 pl-2 border-l border-gray-200">
                  <a href="{% url 'dashboard:permit_types_list' %}" 
                     class="nav-link {% if 'permit_types' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'permit_types' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h5a1 1 0 000-2H4V5h12v3a1 1 0 102 0V5a2 2 0 00-2-2H4z"/>
                      <path d="M14 11a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1v-1z"/>
                    </svg>
                    <span class="truncate">Permit Types</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'dashboard:staff_list' %}" 
                     class="nav-link {% if 'staff' in current_url %}nav-link-active{% endif %}"
                     aria-current="{% if 'staff' in current_url %}page{% endif %}">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                      <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                    </svg>
                    <span class="truncate">Staff</span>
                  </a>
                </li>
                {% endif %}
              </ul>
              {% endwith %}
            {% endif %}

            {% if user.is_authenticated and is_super_admin %}
              <a href="{% url 'super_admin:home' %}" class="nav-link nav-link-active">
                <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                  <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
                <span class="truncate">Platform Admin</span>
              </a>
            {% endif %}
          </nav>

          <!-- Right Side Actions -->
          <div class="flex items-center space-x-3">
            {% if user.is_authenticated %}
              
              <!-- Quick Actions -->
              <div class="hidden md:flex items-center space-x-2">
                {% if not is_super_admin %}
                <a href="{% url 'dashboard:vehicles_create' %}" 
                   class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 01-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                  </svg>
                  Add Vehicle
                </a>
                {% endif %}
              </div>
              
              <!-- Notifications -->
              <div class="relative">
                <button type="button" 
                        class="relative p-2.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl transition-all duration-150"
                        aria-label="View notifications"
                        onclick="toggleNotifications()">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                  </svg>
                  <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full animate-pulse" id="notification-badge" style="display: none;"></span>
                </button>
                
                <!-- Notifications Dropdown -->
                <div id="notifications-dropdown" 
                     class="absolute right-0 z-50 mt-2 w-80 origin-top-right rounded-xl bg-white shadow-xl ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                     role="menu">
                  <div class="p-4 border-b border-gray-100 flex items-center justify-between">
                    <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                    <button onclick="markAllAsRead()" class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                      Mark all read
                    </button>
                  </div>
                  <div id="notifications-list" class="max-h-80 overflow-y-auto">
                    <div class="p-4 text-sm text-gray-500 text-center" id="notifications-loading">
                      Loading notifications...
                    </div>
                  </div>
                  <div class="p-3 border-t border-gray-100 text-center space-y-2">
                    <button onclick="loadMoreNotifications()" class="block w-full text-xs text-blue-600 hover:text-blue-800 font-medium" id="load-more-btn" style="display: none;">
                      Load more
                    </button>
                    <a href="{% url 'notifications:center' %}" class="block w-full text-xs text-gray-500 hover:text-gray-900 font-medium">
                      Open full Notification Center
                    </a>
                  </div>
                </div>
              </div>

              <!-- User Menu -->
              <div class="relative">
                <button type="button" 
                        class="flex items-center space-x-3 text-sm text-gray-700 hover:text-gray-900 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl px-3 py-2 transition-all duration-150"
                        id="user-menu-button" 
                        aria-expanded="false" 
                        aria-haspopup="true"
                        onclick="toggleUserMenu()">
                  <div class="relative">
                    <div class="w-9 h-9 bg-gradient-to-br from-blue-100 via-blue-200 to-indigo-200 rounded-xl flex items-center justify-center shadow-sm">
                      <span class="text-blue-700 font-semibold text-sm">
                        {{ user.first_name|first|default:user.username|first|upper }}
                      </span>
                    </div>
                    <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                  </div>
                  <div class="hidden sm:block text-left">
                    <div class="font-semibold text-gray-900">{{ user.get_full_name|default:user.username }}</div>
                    <div class="text-xs text-gray-500 font-medium">{{ user.get_role_display|default:user.role|title }}</div>
                  </div>
                  <svg class="w-4 h-4 text-gray-400 transition-transform duration-150" id="user-menu-arrow" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </button>

                <!-- Dropdown Menu -->
                <div id="user-menu-dropdown" 
                     class="absolute right-0 z-50 mt-2 w-64 origin-top-right rounded-xl bg-white shadow-xl ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                     role="menu" 
                     aria-orientation="vertical" 
                     aria-labelledby="user-menu-button">
                  <div class="py-2" role="none">
                    <div class="px-4 py-3 border-b border-gray-100">
                      <p class="text-sm font-semibold text-gray-900">{{ user.get_full_name|default:user.username }}</p>
                      <p class="text-xs text-gray-500">{{ user.email }}</p>
                      {% if is_super_admin %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 mt-2">
                          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L3 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.734.99A.996.996 0 0118 6v2a1 1 0 11-2 0v-.277l-1.254-.145a1 1 0 11-.992-1.736L14.984 6l-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.723V12a1 1 0 11-2 0v-1.277l-1.246-.855a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.277l1.254.145a1 1 0 01-.992 1.736l-1.48-.848A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.52.878l-1.48.848a1 1 0 11-.992-1.736L16 13.277V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364.372l.254.145V16a1 1 0 112 0v1.021l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z" clip-rule="evenodd"/>
                          </svg>
                          Super Admin
                        </span>
                      {% endif %}
                    </div>
                    
                    <a href="{% url 'accounts:profile_settings' %}" class="dropdown-item" role="menuitem">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                      </svg>
                      <span>Profile Settings</span>
                    </a>
                    
                    <a href="{% url 'accounts:change_password' %}" class="dropdown-item" role="menuitem">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 116 0z" clip-rule="evenodd"/>
                      </svg>
                      <span>Change Password</span>
                    </a>
                    
                    {% if user.role == 'admin' %}
                    <a href="{% url 'dashboard:organization_settings' %}" class="dropdown-item" role="menuitem">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                      </svg>
                      <span>Organization Settings</span>
                    </a>
                    {% endif %}
                    
                    <a href="{% url 'dashboard:support_list' %}" class="dropdown-item" role="menuitem">
                      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.6-5.6L10 3.2 5.6 8 3 6.4l4.6 4.6 1.6-1.6z" clip-rule="evenodd"/>
                      </svg>
                      <span>Help & Support</span>
                    </a>
                    
                    <div class="border-t border-gray-100 my-1"></div>
                    
                    <form method="post" action="{% url 'accounts:logout' %}" class="block">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item w-full text-left text-red-700 hover:bg-red-50 hover:text-red-800" role="menuitem">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                          <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
                        </svg>
                        <span>Sign Out</span>
                      </button>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Mobile Menu Button -->
              <button type="button" 
                      class="lg:hidden p-2.5 text-gray-400 hover:text-gray-600 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-xl transition-all duration-150"
                      onclick="toggleMobileMenu()"
                      aria-label="Open main menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
              </button>
              
            {% else %}
              <a href="{% url 'accounts:login' %}" class="btn-primary">
                Sign in
              </a>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Mobile Navigation -->
      {% if user.is_authenticated and not is_super_admin %}
      <div class="lg:hidden border-t border-gray-200/50 bg-white/95 backdrop-blur-sm hidden" id="mobile-menu">
        <div class="px-4 py-3 space-y-1">
          {% with current_url=request.resolver_match.url_name %}
          
          <a href="{% url 'dashboard:home' %}" class="mobile-nav-link {% if current_url == 'home' %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
            </svg>
            Dashboard
          </a>
          
          <a href="{% url 'dashboard:customers_list' %}" class="mobile-nav-link {% if 'customer' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
            </svg>
            Customers
          </a>
          
          <a href="{% url 'dashboard:vehicles_list' %}" class="mobile-nav-link {% if 'vehicle' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
            </svg>
            Vehicles
          </a>
          
          <a href="{% url 'dashboard:policies_list' %}" class="mobile-nav-link {% if 'polic' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" clip-rule="evenodd"/>
            </svg>
            Policies
          </a>
          
          <a href="{% url 'dashboard:policies_report' %}" class="mobile-nav-link {% if 'report' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
            </svg>
            Reports
          </a>
          
          {% if user.role == 'admin' or user.role == 'manager' %}
          <a href="{% url 'dashboard:permit_types_list' %}" class="mobile-nav-link {% if 'permit_types' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h5a1 1 0 000-2H4V5h12v3a1 1 0 102 0V5a2 2 0 00-2-2H4z"/>
              <path d="M14 11a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1v-1z"/>
            </svg>
            Permit Types
          </a>

          <a href="{% url 'dashboard:staff_list' %}" class="mobile-nav-link {% if 'staff' in current_url %}mobile-nav-link-active{% endif %}">
            <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
            </svg>
            Staff
          </a>
          {% endif %}
          
          {% endwith %}
        </div>
      </div>
      {% endif %}
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1" role="main">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
        <!-- Platform Notifications -->
        {% if platform_config and platform_config.maintenance_mode %}
          <div class="mb-6 rounded-lg border-l-4 border-warning-500 bg-warning-50 p-4 animate-fade-in" role="alert">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-warning-500" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-warning-800">Maintenance Mode Active</h3>
                {% if platform_config.support_email %}
                  <p class="mt-1 text-sm text-warning-700">
                    For assistance, contact <a href="mailto:{{ platform_config.support_email }}" class="underline">{{ platform_config.support_email }}</a>
                  </p>
                {% endif %}
              </div>
            </div>
          </div>
        {% endif %}
        
        {% if platform_config and platform_config.announcement_message %}
          <div class="mb-6 rounded-lg border-l-4 border-brand-500 bg-brand-50 p-4 animate-fade-in" role="alert">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-brand-500" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-brand-800">{{ platform_config.announcement_message }}</p>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Flash Messages -->
        {% if messages %}
          <div class="space-y-4 mb-6" role="alert" aria-live="polite">
            {% for message in messages %}
              <div class="rounded-lg p-4 animate-slide-up {% if message.tags == 'success' %}bg-success-50 border border-success-200{% elif message.tags == 'warning' %}bg-warning-50 border border-warning-200{% elif message.tags == 'error' %}bg-error-50 border border-error-200{% else %}bg-gray-50 border border-gray-200{% endif %}"
                   {% if 'no-autohide' in message.tags %}data-sticky="true"{% endif %}>
                <div class="flex">
                  <div class="flex-shrink-0">
                    {% if message.tags == 'success' %}
                      <svg class="h-5 w-5 text-success-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                      </svg>
                    {% elif message.tags == 'warning' %}
                      <svg class="h-5 w-5 text-warning-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                      </svg>
                    {% elif message.tags == 'error' %}
                      <svg class="h-5 w-5 text-error-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                      </svg>
                    {% else %}
                      <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                      </svg>
                    {% endif %}
                  </div>
                  <div class="ml-3 flex items-start justify-between gap-3 w-full">
                    <p class="flex-1 text-sm {% if message.tags == 'success' %}text-success-800{% elif message.tags == 'warning' %}text-warning-800{% elif message.tags == 'error' %}text-error-800{% else %}text-gray-800{% endif %}">
                      {{ message }}
                    </p>
                    {% if 'no-autohide' in message.tags %}
                      <button type="button"
                              class="inline-flex items-center px-2 py-1 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                              data-copy-message="true"
                              aria-label="Copy message to clipboard">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2M8 16h8a2 2 0 012 2v-2a2 2 0 01-2-2H8zm0-4a2 2 0 012-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v4a2 2 0 002 2z"/>
                        </svg>
                        Copy
                      </button>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          {% endif %}

        <!-- Page Content -->
        {% block content %}{% endblock %}
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto" role="contentinfo">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <p class="text-sm text-gray-500">
            &copy; {% now "Y" %} Vehicle Insurance System. Built with security and accessibility in mind.
          </p>
          <div class="flex items-center space-x-6">
            <a href="#" class="text-sm text-gray-500 hover:text-gray-900 transition-colors">Privacy Policy</a>
            <a href="#" class="text-sm text-gray-500 hover:text-gray-900 transition-colors">Terms of Service</a>
            <a href="{% url 'dashboard:support_list' %}" class="text-sm text-gray-500 hover:text-gray-900 transition-colors">Support</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script>
      // Auto-hide non-critical flash messages after 5 seconds
      document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('[role="alert"][aria-live="polite"] > div');
        messages.forEach(function(message) {
          // Messages marked as sticky (e.g. temporary passwords) stay visible
          if (message.dataset.sticky === 'true') {
            return;
          }
          setTimeout(function() {
            message.style.transition = 'opacity 0.5s ease-out';
            message.style.opacity = '0';
            setTimeout(function() {
              message.remove();
            }, 500);
          }, 5000);
        });
      });

      // Copy-to-clipboard for sticky flash messages (e.g. temporary passwords)
      document.addEventListener('click', function(event) {
        const button = event.target.closest('button[data-copy-message="true"]');
        if (!button) {
          return;
        }
        const container = button.closest('[role="alert"][aria-live="polite"] > div');
        if (!container) {
          return;
        }
        const textEl = container.querySelector('p');
        if (!textEl) {
          return;
        }
        const rawText = textEl.innerText || textEl.textContent || '';
        if (!rawText) {
          return;
        }

        // By default copy the whole message, but if this is a
        // temporary-password style message, extract just the password
        // token. We look for the pattern "Temporary password: <VALUE>".
        let textToCopy = rawText;
        const tempMatch = rawText.match(/Temporary password:\s*([^\s.]+)/i);
        if (tempMatch && tempMatch[1]) {
          textToCopy = tempMatch[1];
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(textToCopy).catch(function() {});
        } else {
          const textarea = document.createElement('textarea');
          textarea.value = textToCopy;
          textarea.style.position = 'fixed';
          textarea.style.opacity = '0';
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();
          try {
            document.execCommand('copy');
          } catch (e) {}
          document.body.removeChild(textarea);
        }

        // Fade out and remove the message after copying
        container.style.transition = 'opacity 0.3s ease-out';
        container.style.opacity = '0';
        setTimeout(function() {
          container.remove();
        }, 300);
      });
      
      // Notifications functionality
      let notificationsPage = 1;
      let notificationsLoaded = false;
      
      // Notifications dropdown functionality
      function toggleNotifications() {
        const dropdown = document.getElementById('notifications-dropdown');
        if (dropdown) {
          const isHidden = dropdown.classList.contains('hidden');
          dropdown.classList.toggle('hidden');
          
          if (isHidden && !notificationsLoaded) {
            loadNotifications();
          }
        }
      }
      
      function loadNotifications(page = 1) {
        const loadingEl = document.getElementById('notifications-loading');
        const listEl = document.getElementById('notifications-list');
        
        if (page === 1) {
          loadingEl.style.display = 'block';
        }
        
        fetch(`/api/notifications/?page=${page}&per_page=10`)
          .then(response => response.json())
          .then(data => {
            if (page === 1) {
              listEl.innerHTML = '';
              notificationsLoaded = true;
            }
            
            if (data.notifications.length === 0 && page === 1) {
              listEl.innerHTML = '<div class="p-4 text-sm text-gray-500 text-center">No notifications</div>';
            } else {
              data.notifications.forEach(notification => {
                const notifEl = createNotificationElement(notification);
                listEl.appendChild(notifEl);
              });
            }
            
            // Update badge
            updateNotificationBadge(data.unread_count);
            
            // Show/hide load more button
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (data.pagination.has_next) {
              loadMoreBtn.style.display = 'block';
              notificationsPage = page;
            } else {
              loadMoreBtn.style.display = 'none';
            }
            
            loadingEl.style.display = 'none';
          })
          .catch(error => {
            console.error('Error loading notifications:', error);
            loadingEl.innerHTML = '<div class="p-4 text-sm text-red-500 text-center">Error loading notifications</div>';
          });
      }
      
      function createNotificationElement(notification) {
        const div = document.createElement('div');
        div.className = `notification-item p-4 border-b border-gray-50 hover:bg-gray-25 transition-colors cursor-pointer ${!notification.is_read ? 'bg-blue-25' : ''}`;
        div.onclick = () => markAsReadAndNavigate(notification);
        
        const priorityColors = {
          'critical': 'text-red-600',
          'high': 'text-orange-600',
          'medium': 'text-blue-600',
          'low': 'text-gray-600'
        };
        
        const timeAgo = getTimeAgo(new Date(notification.created_at));
        
        div.innerHTML = `
          <div class="flex items-start space-x-3">
            <div class="flex-shrink-0">
              <div class="w-2 h-2 ${priorityColors[notification.priority] || 'text-gray-600'} rounded-full mt-2"></div>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <p class="text-sm font-medium text-gray-900 truncate">${notification.title}</p>
                ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full"></div>' : ''}
              </div>
              <p class="text-xs text-gray-500 mt-1 line-clamp-2">${notification.message}</p>
              <p class="text-xs text-gray-400 mt-1">${timeAgo}</p>
            </div>
          </div>
        `;
        
        return div;
      }
      
      function markAsReadAndNavigate(notification) {
        if (!notification.is_read) {
          fetch(`/api/notifications/${notification.id}/mark-read/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': getCsrfToken()
            }
          });
        }
        
        if (notification.action_url) {
          window.location.href = notification.action_url;
        }
      }
      
      function markAllAsRead() {
        fetch('/api/notifications/mark-read/', {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCsrfToken()
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Refresh notifications
            notificationsLoaded = false;
            loadNotifications();
          }
        });
      }
      
      function loadMoreNotifications() {
        loadNotifications(notificationsPage + 1);
      }
      
      function updateNotificationBadge(count) {
        const badge = document.getElementById('notification-badge');
        if (count > 0) {
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      }
      
      function getTimeAgo(date) {
        const now = new Date();
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) return 'Just now';
        if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
        if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
        return `${Math.floor(diffInSeconds / 86400)}d ago`;
      }
      
      function getCsrfToken() {
        return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
      }
      
      // Load notification count on page load
      document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/notifications/count/')
          .then(response => response.json())
          .then(data => {
            updateNotificationBadge(data.unread_count);
          })
          .catch(error => console.error('Error loading notification count:', error));
      });
      
      // User menu dropdown functionality
      function toggleUserMenu() {
        const dropdown = document.getElementById('user-menu-dropdown');
        const button = document.getElementById('user-menu-button');
        const arrow = document.getElementById('user-menu-arrow');
        
        if (dropdown.classList.contains('hidden')) {
          dropdown.classList.remove('hidden');
          button.setAttribute('aria-expanded', 'true');
          arrow.style.transform = 'rotate(180deg)';
        } else {
          dropdown.classList.add('hidden');
          button.setAttribute('aria-expanded', 'false');
          arrow.style.transform = 'rotate(0deg)';
        }
      }
      
      // Mobile menu functionality
      function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenu) {
          mobileMenu.classList.toggle('hidden');
        }
      }
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', function(event) {
        const userMenu = document.getElementById('user-menu-dropdown');
        const userButton = document.getElementById('user-menu-button');
        const notificationsMenu = document.getElementById('notifications-dropdown');
        
        if (userMenu && !userButton.contains(event.target) && !userMenu.contains(event.target)) {
          userMenu.classList.add('hidden');
          userButton.setAttribute('aria-expanded', 'false');
          document.getElementById('user-menu-arrow').style.transform = 'rotate(0deg)';
        }
        
        if (notificationsMenu && !event.target.closest('[onclick="toggleNotifications()"]') && !notificationsMenu.contains(event.target)) {
          notificationsMenu.classList.add('hidden');
        }
      });
      
      // Keyboard navigation for dropdowns
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const userMenu = document.getElementById('user-menu-dropdown');
          const mobileMenu = document.getElementById('mobile-menu');
          const notificationsMenu = document.getElementById('notifications-dropdown');
          
          if (userMenu && !userMenu.classList.contains('hidden')) {
            userMenu.classList.add('hidden');
            document.getElementById('user-menu-button').setAttribute('aria-expanded', 'false');
            document.getElementById('user-menu-arrow').style.transform = 'rotate(0deg)';
          }
          
          if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.add('hidden');
          }
          
          if (notificationsMenu && !notificationsMenu.classList.contains('hidden')) {
            notificationsMenu.classList.add('hidden');
          }
        }
      });
      
      // Form validation enhancement
      document.querySelectorAll('form').forEach(function(form) {
        form.addEventListener('submit', function(e) {
          const requiredFields = form.querySelectorAll('[required]');
          let isValid = true;
          
          requiredFields.forEach(function(field) {
            if (!field.value.trim()) {
              field.classList.add('border-error-500', 'focus:border-error-500', 'focus:ring-error-500');
              isValid = false;
            } else {
              field.classList.remove('border-error-500', 'focus:border-error-500', 'focus:ring-error-500');
            }
          });
          
          if (!isValid) {
            e.preventDefault();
          }
        });
      });
    </script>
    
    {% block extra_js %}{% endblock %}
  </body>
</html>