{% extends "base.html" %}
{% load dict_extras %}
{% block content %}
<div class="flex items-center justify-between mb-4">
  <h1 class="text-xl font-semibold">Policy {{ policy.policy_number }}</h1>
  <div class="flex gap-2">
    <a href="{% url 'dashboard:policies_update' policy.pk %}" class="inline-flex items-center rounded border border-sky-600 text-sky-700 hover:bg-sky-50 px-3 py-2">Edit</a>
    <a href="{% url 'dashboard:payments_create' %}?policy={{ policy.pk }}" class="inline-flex items-center rounded bg-green-600 px-3 py-2 text-white hover:bg-green-700">Record Payment</a>
    <a href="{% url 'dashboard:policies_list' %}" class="inline-flex items-center rounded border px-3 py-2 text-sm hover:bg-gray-50">Back</a>
  </div>
</div>

<div class="grid grid-cols-12 gap-4">
  <div class="col-span-12 lg:col-span-7">
    <div class="bg-white rounded shadow p-4">
      <div class="grid grid-cols-12 gap-y-3">
        <div class="col-span-4 text-sm text-gray-600">Status</div>
        <div class="col-span-8">
          {% if policy.status == 'active' %}<span class="inline-flex rounded bg-green-100 text-green-800 px-2 py-1 text-xs">Active</span>{% endif %}
          {% if policy.status == 'pending_payment' %}<span class="inline-flex rounded bg-yellow-100 text-yellow-800 px-2 py-1 text-xs">Pending Payment</span>{% endif %}
          {% if policy.status == 'draft' %}<span class="inline-flex rounded bg-gray-200 text-gray-800 px-2 py-1 text-xs">Draft</span>{% endif %}
          {% if policy.status == 'expired' %}<span class="inline-flex rounded bg-gray-800 text-white px-2 py-1 text-xs">Expired</span>{% endif %}
          {% if policy.status == 'cancelled' %}<span class="inline-flex rounded bg-red-100 text-red-800 px-2 py-1 text-xs">Cancelled</span>{% endif %}
        </div>
        <div class="col-span-4 text-sm text-gray-600">Vehicle</div>
        <div class="col-span-8">{{ policy.vehicle.registration_number }} ({{ policy.vehicle.make }} {{ policy.vehicle.model }})</div>
        <div class="col-span-4 text-sm text-gray-600">Customer</div>
        <div class="col-span-8">
          {% if policy.vehicle.owner.customer_type == 'individual' %}
            {{ policy.vehicle.owner.first_name }} {{ policy.vehicle.owner.last_name }}
          {% else %}
            {{ policy.vehicle.owner.company_name }}
          {% endif %}
        </div>
        <div class="col-span-4 text-sm text-gray-600">Period</div>
        <div class="col-span-8">{{ policy.start_date|date:"Y-m-d" }} â†’ {{ policy.end_date|date:"Y-m-d" }}</div>
        <div class="col-span-4 text-sm text-gray-600">Premium</div>
        <div class="col-span-8">{{ policy.premium_amount }}</div>
        <div class="col-span-4 text-sm text-gray-600">Coverage</div>
        <div class="col-span-8">{{ policy.coverage_amount }}</div>
        <div class="col-span-4 text-sm text-gray-600">Policy Type</div>
        <div class="col-span-8">{{ policy.policy_type }}</div>
        {% if policy.status == 'cancelled' %}
        <div class="col-span-4 text-sm text-gray-600">Cancelled At</div>
        <div class="col-span-8">{{ policy.cancelled_at }}</div>
        <div class="col-span-4 text-sm text-gray-600">Reason</div>
        <div class="col-span-8">{{ policy.cancellation_reason }}</div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-span-12 lg:col-span-5">
    {% if df_defs %}
    <div class="bg-white rounded shadow">
      <div class="border-b px-4 py-2 font-medium">Additional Fields</div>
      <div class="p-4 grid grid-cols-1 gap-2">
        {% for d in df_defs %}
        <div>
          <div class="text-xs text-gray-500">{{ d.name }}</div>
          <div>{{ df_values|get_item:d.key }}</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
